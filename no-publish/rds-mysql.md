<!-- MOVE TO _log-sources COLLECTION WHEN READY TO PUBLISH -->
---
title: Ship RDS logs for MySQL
logo:
  logofile: aws-rds.svg
  orientation: vertical
shipping-summary:
  data-source: Amazon RDS (MySQL)
logzio-app-url: https://app.logz.io/#/dashboard/send-your-data/log-sources/rds
contributors:
  - imnotashrimp
shipping-tags:
  - aws
  - database
---

If you manage a MySQL database on Amazon RDS,
we recommend using a Filebeat container to ship your MySQL logs to Logz.io.
You can monitor the MySQL general query log, slow query log, and error log.

**You'll need**:
An IAM user with **`xx`** permissions

{: .tasklist .inline-headline }
1. Enable RDS logging

    The RDS creates the MySQL error log file by default,
    but you'll need to enable the general query log and slow query log.

    To do this, set the right parameters in your DB parameter group.

---

########## Copied from original in-app docs ##############

# Configuring RDS

You can configure RDS to ship MySQL log data to [logz.io](https://logz.io).
You can monitor the MySQL error log, slow query log, and the general log.

## Requirements

 - A user with permissions to List the buckets on the relevant S3 Bucket and permission to Get from all the paths under that bucket name. Click [here](http://support.logz.io/hc/en-us/articles/209486129-Troubleshooting-AWS-IAM-Configuration-for-retrieving-logs-from-a-S3-Bucket) for a guide to troubleshoot user permissions.

## [[step 1]] **Enable RDS log files**
You need to enable the creation of log files in RDS; the MySQL error log is generated by default. You can generate the slow query and general logs by setting parameters in your DB parameter group. 

For more details [click here](http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_LogAccess.Concepts.MySQL.html)

## [[step 2]] **Create IAM**
Pulling RDS MySQL log files is done using the RDSCli tool. Using it will require that you supply the access key and secret key of an IAM user that has permission to watch and describe RDS log files.

For more details [click here](http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.html)

## [[step 3]] **Ship Logs**

In order to ship the logs, you can either:

- Use a Docker container that internally pulls logs from RDS using a pre-baked configuration that ships the log files to [logz.io](https://logz.io)

- Pull the log files from RDS to a local directory and then ship them over to [Logz.io](http://logz.io) using Rsyslog configuration.

### Option One

---

You can use a Docker image that is pre-baked with the Filebeat and RDSCli tools to ship RDS logs to Logz.io. 

#### **Run example:**
```
docker run -d --name logzio-mysql-logs \
  -e LOGZIO_TOKEN="{{API_TOKEN}}" \
  -e LOGZIO_LISTENER_HOST="{{LOGZ_LISTENER}}" \
  -e AWS_ACCESS_KEY="YOUR_ACCESS_KEY" \
  -e AWS_SECRET_KEY="YOUR_SECRET_KEY" \
  -e AWS_REGION="YOUR_REGION" \
  -e RDS_IDENTIFIER="YOUR_DB_IDENTIFIER" \
  -e RDS_ERROR_LOG_FILE=error/mysql-error.log \
  -e RDS_SLOW_LOG_FILE=slowquery/mysql-slowquery.log \
  -e RDS_LOG_FILE=general/mysql-general.log \
  -v /var/log/logzio:/var/log/logzio \
  -v /var/log/mysql:/var/log/mysql \
  logzio/mysql-logs:latest
```

#### **Usage (Mandatory)**


- **LOGZIO_TOKEN** - Your [Logz.io App](https://app.logz.io) token, where you can find under "settings" in the web app.

- **LOGZIO_LISTENER** - Logzio listener host name - {{LOGZ_LISTENER}}

- **AWS_ACCESS_KEY** - A proper AMI credentials for RDS logs access (permissions for download-db-log-file-portion and describe-db-log-files are needed)

- **AWS_SECRET_KEY** - A proper AMI credentials for RDS logs access (permissions for download-db-log-file-portion and describe-db-log-files are needed)

- **RDS_IDENTIFIER** - The RDS identifier of the host from which you want to read logs.

#### **Usage (Optional)**


- **RDS_ERROR_LOG_FILE** - The path to the RDS error log file. Default: error/mysql-error.log

- **RDS_SLOW_LOG_FILE** - The path to the RDS slow query log file. Default: slowquery/mysql-slowquery.log

- **RDS_LOG_FILE** - The path to the RDS general log file. Default: general/mysql-general.log

- **INTERVAL_SECONDS** - The number of seconds to wait between each call to monitor. Default: 60

- **AWS_REGION** - The RDS AWS region. Default: us-east-1

### Option Two

---


##### Install the AWS RDS Command Line Tools and Configure Access:

**1.** Obtain the command line tools: 
   
```
wget http://s3.amazonaws.com/rds-downloads/RDSCli.zip
```

**2.** Copy the zip file to the desired installation path and unzip:

```
unzip ./RDSCli.zip
```

**3.** Set up the required environment variables (the following might look different on your system):

```
export AWS_RDS_HOME=/home/ec2-user/RDSCli-1.15.001/
export PATH=$PATH:$AWS_RDS_HOME/bin
export JAVA_HOME=/usr/lib/jvm/jre
export AWS_CREDENTIAL_FILE=$AWS_RDS_HOME/credential-file-path.template
```

**4.** Add access keys to the AWS_CREDENTIAL_FILE:

```
AWSAccessKeyId=<Write your AWS access ID>
AWSSecretKey=<Write your AWS secret key>
```
You must also be sure that the user account interacting with RDS has the proper permissions configured in IAM.

**5.** Verify by issuing the following command (all of the enabled log files should be listed in the response):

```
rds-describe-db-log-files <rds instance name here>
```

##### Watching RDS log files

RDS command line tools provide an option to continuously monitor log files for activity. For each log file you wish to monitor, run the watch command in the background and output its content to a file. Here's an example:

```
rds-watch-db-logfile <rds instance name here> --log-file-name error/mysql-error.log >> path/to/mysql/log/error.log &
```

##### Configuring Rsyslog to Ship Log Files to Logz.io

The script will attempt to resolve the location of the log files using the following defaults:
- general **/var/log/mysql/mysql.log** (can be overrided using the option --generallog)
- slow-log **/var/log/mysql/mysql-slow.log** (can be overrided using the option --slowlog)
- error **/var/log/mysql/error.log** (can be overrided using the option -- errorlog)

```
curl -sLO https://github.com/logzio/logzio-shipper/raw/master/dist/logzio-rsyslog.tar.gz && tar xzf logzio-rsyslog.tar.gz && sudo rsyslog/install.sh -t mysql -a "{{API_TOKEN}}"
```

You can verify that logs are being sent by searching for MySQL log file types in Kibana:
- **mysql** 
- **mysql_error**
- **mysql_slow_query**
